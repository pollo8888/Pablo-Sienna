# ANÃLISIS DEL SISTEMA SIENNA
## Flujo de Trabajo y Arquitectura del Proyecto

---

## ğŸ“‹ INFORMACIÃ“N GENERAL DEL PROYECTO

**Nombre**: Sistema de AdministraciÃ³n SIENNA  
**PerÃ­odo de desarrollo**: Inicia 29/07/2025  
**Desarrollador**: Ing. Uzziel LÃ³pez Valdez

**IMPORTANTE**: Este sistema anteriormente se llamaba FULTRA, ahora se denomina **SIENNA**. Toda referencia a FULTRA debe entenderse como SIENNA.

---

## ğŸ¯ PROPÃ“SITO DEL SISTEMA

Sistema especializado para la **gestiÃ³n de operaciones vulnerables ante el SAT**, diseÃ±ado para empresas que manejan mÃºltiples razones sociales y necesitan cumplir con las obligaciones fiscales de prevenciÃ³n de lavado de dinero.

---

## ğŸ¢ ARQUITECTURA REAL DEL SISTEMA

### **MODELO DE IMPLEMENTACIÃ“N**
- **Un sistema = Un cliente especÃ­fico** (ejemplo: Chedraui)
- **InstalaciÃ³n independiente** por cada cliente nuevo
- **Base de datos dedicada** por cliente
- **ConfiguraciÃ³n personalizada** segÃºn necesidades del cliente

### **ROLES Y PERMISOS IMPLEMENTADOS**

#### **1. ADMINISTRADOR (Tipo 1) - TÃš**
**FunciÃ³n**: Setup y configuraciÃ³n inicial del sistema
- Instalas el sistema para el cliente (Chedraui)
- Configuras base de datos y servidor
- Creas LA ÃšNICA cuenta de usuario para el cliente
- Entregas el sistema funcionando

#### **2. USUARIO (Tipo 2) - UNA CUENTA COMPARTIDA PARA TODO CHEDRAUI**
**FunciÃ³n**: OperaciÃ³n diaria del sistema
- **Usuario compartido**: administracion@sienna.mx (actualizado de sienna.mx)
- **ContraseÃ±a compartida**: SecretPass01@
- Gerardo, Ana, Carlos, etc. **todos usan la misma cuenta**
- Todos ven y manejan la misma informaciÃ³n
- Gestionan las empresas filiales de Chedraui

#### **3. VENTAS (Tipo 3) - NO SE USA**
- CÃ³digo existe en el sistema para escalabilidad futura
- Para el proyecto de Chedraui NO se implementa
- Solo hay UNA cuenta de usuario compartida

---

## ğŸ”§ STACK TECNOLÃ“GICO

**Base de datos**: MariaDB 5.5.68  
**Backend**: PHP 7.4.33  
**Frontend**: JavaScript, AJAX  
**AutenticaciÃ³n**: Password hashing (BCRYPT)  
**Email**: SMTP con Amazon SES  

**ConfiguraciÃ³n de Base de Datos** (heredada del sistema original):
```
DBhost = 'localhost'
DBname = 'adm_sienna' (actualizado de adm_sienna)
DBuser = 'adm_sienna' (actualizado de adm_sienna)
DBpass = '!1GfTlyk94f7eOdel'
```

---

## ğŸ“Š FLUJO DE TRABAJO PRINCIPAL

### **FASE 1: SETUP INICIAL (TÃš - ADMINISTRADOR)**
1. **InstalaciÃ³n del sistema** en servidor del cliente
2. **ConfiguraciÃ³n de base de datos** dedicada
3. **PersonalizaciÃ³n de URLs** y dominios
4. **ConfiguraciÃ³n SMTP** del cliente
5. **CreaciÃ³n de LA cuenta Ãºnica** para el cliente
6. **Entrega y capacitaciÃ³n**

### **FASE 2: OPERACIÃ“N DIARIA (CHEDRAUI - USUARIOS)**

#### **1. Acceso al Sistema**
- Todos los empleados usan: `administracion@sienna.mx` (actualizado)
- Misma contraseÃ±a para todos: `SecretPass01@`
- Sin segregaciÃ³n de usuarios

#### **2. GestiÃ³n de Empresas**
- Registro de las diferentes razones sociales que maneja Chedraui:
  - Inmobiliaria El Faro
  - Constructora Tezontle  
  - Otras filiales de Chedraui
- CreaciÃ³n automÃ¡tica de estructura de carpetas por empresa

#### **3. GestiÃ³n de Clientes**
- Registro de clientes por cada empresa
- Tipos soportados: Persona FÃ­sica, Persona Moral, Fideicomiso
- OrganizaciÃ³n jerÃ¡rquica automÃ¡tica de carpetas

#### **4. GestiÃ³n Documental**
- Almacenamiento estructurado por empresa/cliente
- Subida de documentos (INE, contratos, comprobantes)
- Sistema de carpetas automÃ¡tico:

```
ğŸ“ Empresa (ej. Inmobiliaria El Faro)
â””â”€â”€ ğŸ“ Cliente 1 (ej. Juan PÃ©rez)
    â”œâ”€â”€ ğŸ“„ INE
    â”œâ”€â”€ ğŸ“„ Contrato
    â””â”€â”€ ğŸ“„ Comprobantes
â””â”€â”€ ğŸ“ Cliente 2 (ej. Ana Torres)
    â””â”€â”€ ğŸ“„ Documentos...
```

#### **5. Operaciones Vulnerables**
- Registro de operaciones por tipo de cliente
- ValidaciÃ³n automÃ¡tica de umbrales SAT
- GeneraciÃ³n automÃ¡tica de avisos cuando se requiere
- Seguimiento de compliance fiscal

---

## ğŸ—ï¸ ARQUITECTURA DEL SISTEMA

### **MÃ“DULOS PRINCIPALES**
- **Usuarios**: GestiÃ³n de empleados y permisos (solo para admin)
- **Empresas**: Registro de razones sociales de Chedraui
- **Clientes**: Base de datos de clientes por empresa
- **Documentos**: Sistema de archivos organizado
- **Operaciones Vulnerables**: Registro y seguimiento SAT
- **Notificaciones**: Sistema automatizado de alertas

### **ESTRUCTURA ORGANIZACIONAL**
```
ğŸ¢ SISTEMA CHEDRAUI
â”œâ”€â”€ ğŸ‘¨â€ğŸ’¼ Admin (TÃº) - Solo setup inicial
â””â”€â”€ ğŸ‘¥ UNA CUENTA COMPARTIDA
    â”œâ”€â”€ Gerardo usa esta cuenta
    â”œâ”€â”€ Ana usa esta cuenta  
    â”œâ”€â”€ Carlos usa esta cuenta
    â””â”€â”€ Todos gestionan:
        â”œâ”€â”€ ğŸª Inmobiliaria El Faro
        â”œâ”€â”€ ğŸ—ï¸ Constructora Tezontle
        â””â”€â”€ ğŸ“„ Mismos clientes y documentos
```

---

## âš™ï¸ CONFIGURACIONES TÃ‰CNICAS CRÃTICAS

### **ARCHIVOS A MODIFICAR POR INSTALACIÃ“N**
1. **app/Connector.php** â†’ Credenciales BD del cliente
2. **app/FileController.php** â†’ Rutas de almacenamiento  
3. **app/MailController.php** â†’ SMTP del cliente
4. **resources/js/notifications.js** â†’ URLs del dominio
5. **.htaccess** â†’ ProtecciÃ³n de documentos
6. **app/emailsTemplates/sendNoticeCustomers.php** â†’ Enlaces del sistema

### **ALMACENAMIENTO DE ARCHIVOS**
- **Interno**: `../../uploads/documents/`
- **Externo**: `E:/uploads/documents/` (configurable)
- **ProtecciÃ³n**: .htaccess para URLs seguras

### **CONFIGURACIÃ“N EMAIL SMTP** (heredada, a actualizar)
- **Servidor**: Amazon SES (email-smtp.us-east-2.amazonaws.com)
- **Puerto**: 465
- **From**: notificaciones@sienna.mx (actualizado de atencionsienna.mx)

### **LÃMITES DEL SERVIDOR**
- **memory_limit**: 1024M
- **post_max_size**: 510M  
- **upload_max_filesize**: 500M
- **max_execution_time**: 600

---

## ğŸ”„ CASO PRÃCTICO: FLUJO DIARIO DE GERARDO

### **Escenario**: Gerardo (empleado de Chedraui) registra una nueva operaciÃ³n

1. **Login** â†’ Se logea con `administracion@sienna.mx`

2. **Registro de Empresa** â†’ Va al mÃ³dulo Empresas
   - Agrega "Inmobiliaria El Faro"
   - El sistema crea automÃ¡ticamente la carpeta

3. **Registro de Cliente** â†’ Va al mÃ³dulo Clientes  
   - Agrega "Juan PÃ©rez" para "Inmobiliaria El Faro"
   - El sistema crea subcarpeta automÃ¡ticamente

4. **Subida de Documentos** â†’ Entra a la carpeta de Juan PÃ©rez
   - Sube INE, contrato, comprobantes
   - Todo queda organizado automÃ¡ticamente

5. **Registro de OperaciÃ³n Vulnerable** â†’ Desde la empresa
   - Registra operaciÃ³n de compra por $1,700,000
   - El sistema valida automÃ¡ticamente si requiere aviso SAT
   - Genera alerta si excede umbrales

### **Resultado Final en el Sistema**
```
ğŸ“ Inmobiliaria El Faro
â””â”€â”€ ğŸ“ Juan PÃ©rez
    â”œâ”€â”€ ğŸ“„ INE.pdf
    â”œâ”€â”€ ğŸ“„ Contrato.pdf
    â””â”€â”€ ğŸ“„ Comprobante.pdf

ğŸ“ OperaciÃ³n #001
Empresa: Inmobiliaria El Faro
Cliente: Juan PÃ©rez  
Tipo: Compra
Monto: $1,700,000
Estatus: âš ï¸ Requiere aviso al SAT
```

---

## ğŸ“ˆ CARACTERÃSTICAS DESTACADAS

### **AUTOMATIZACIÃ“N**
- CreaciÃ³n automÃ¡tica de carpetas por empresa/cliente
- Validaciones automÃ¡ticas de umbrales SAT
- GeneraciÃ³n automÃ¡tica de alertas y avisos

### **ORGANIZACIÃ“N**
- Estructura jerÃ¡rquica empresa â†’ cliente â†’ documentos
- Sistema de carpetas inteligente
- BÃºsquedas y filtros por empresa/cliente

### **SEGURIDAD**
- AutenticaciÃ³n con hashing BCRYPT
- ProtecciÃ³n de URLs de documentos
- Validaciones de permisos por tipo de usuario

### **ESCALABILIDAD**
- ConfiguraciÃ³n flexible de almacenamiento (interno/externo)
- Sistema preparado para mÃºltiples tipos de usuario
- Arquitectura modular para futuras expansiones

### **COMPLIANCE**
- Cumplimiento automÃ¡tico con obligaciones SAT
- Registro detallado de operaciones vulnerables
- Sistema de alertas y seguimiento

---

## ğŸš¨ PUNTOS DE CONFIGURACIÃ“N IMPORTANTES

### **DEPLOYMENT CHECKLIST**
- [ ] Modificar **6 archivos especÃ­ficos** para cada instalaciÃ³n
- [ ] Configurar **CRON jobs** para tareas programadas  
- [ ] Decidir almacenamiento: **interno vs externo**
- [ ] Configurar **URLs pÃºblicas** vs rutas relativas segÃºn entorno
- [ ] Establecer credenciales SMTP del cliente
- [ ] Crear cuenta Ãºnica de usuario para el cliente

### **CONSIDERACIONES OPERATIVAS**
- Un solo login compartido por toda la organizaciÃ³n del cliente
- Todos los usuarios ven la misma informaciÃ³n
- Sin segregaciÃ³n por departamentos o vendedores  
- Sistema diseÃ±ado para colaboraciÃ³n total del equipo

---

## ğŸ’¼ VALOR DEL SISTEMA

### **PARA EL CLIENTE (CHEDRAUI)**
- Sistema dedicado exclusivamente a sus operaciones
- GestiÃ³n completa de mÃºltiples razones sociales
- Cumplimiento automatizado con obligaciones SAT
- OrganizaciÃ³n eficiente de documentaciÃ³n
- Un solo punto de acceso para todo el equipo

### **PARA TI (ADMINISTRADOR/DESARROLLADOR)**
- Modelo de instalaciÃ³n replicable por cliente
- Sistema escalable para futuras necesidades
- ConfiguraciÃ³n personalizable por implementaciÃ³n  
- Control total sobre cada instalaciÃ³n
- Arquitectura preparada para crecimiento

---

**RESUMEN EJECUTIVO**: El Sistema SIENNA es una soluciÃ³n integral para la gestiÃ³n de operaciones vulnerables ante el SAT, implementado como sistema dedicado por cliente con una cuenta compartida para toda la organizaciÃ³n, automatizando el cumplimiento fiscal y organizando eficientemente la documentaciÃ³n empresarial.